defmodule Tq2.Utils.CountryCurrency do
  @currencies_by_country %{
    "ad" => "EUR",
    "ae" => "AED",
    "af" => "AFN",
    "ag" => "XCD",
    "ai" => "XCD",
    "al" => "ALL",
    "am" => "AMD",
    "ao" => "AOA",
    "aq" => "USD",
    "ar" => "ARS",
    "as" => "USD",
    "at" => "EUR",
    "au" => "AUD",
    "aw" => "AWG",
    "ax" => "EUR",
    "az" => "AZN",
    "ba" => "BAM",
    "bb" => "BBD",
    "bd" => "BDT",
    "be" => "EUR",
    "bf" => "XOF",
    "bg" => "BGN",
    "bh" => "BHD",
    "bi" => "BIF",
    "bj" => "XOF",
    "bl" => "EUR",
    "bm" => "BMD",
    "bn" => "BND",
    "bo" => "BOB",
    "bq" => "USD",
    "br" => "BRL",
    "bs" => "BSD",
    "bt" => "BTN",
    "bv" => "NOK",
    "bw" => "BWP",
    "by" => "BYN",
    "bz" => "BZD",
    "ca" => "CAD",
    "cc" => "AUD",
    "cd" => "CDF",
    "cf" => "XAF",
    "cg" => "XAF",
    "ch" => "CHF",
    "ci" => "XOF",
    "ck" => "NZD",
    "cl" => "CLP",
    "cm" => "XAF",
    "cn" => "CNY",
    "co" => "COP",
    "cr" => "CRC",
    "cu" => "CUP",
    "cv" => "CVE",
    "cw" => "ANG",
    "cx" => "AUD",
    "cy" => "EUR",
    "cz" => "CZK",
    "de" => "EUR",
    "dj" => "DJF",
    "dk" => "DKK",
    "dm" => "XCD",
    "do" => "DOP",
    "dz" => "DZD",
    "ec" => "USD",
    "ee" => "EUR",
    "eg" => "EGP",
    "eh" => "MAD",
    "er" => "ETB",
    "es" => "EUR",
    "et" => "ETB",
    "fi" => "EUR",
    "fj" => "FJD",
    "fk" => "FKP",
    "fm" => "USD",
    "fo" => "DKK",
    "fr" => "EUR",
    "ga" => "XAF",
    "gb" => "GBP",
    "gd" => "XCD",
    "ge" => "GEL",
    "gf" => "EUR",
    "gg" => "GBP",
    "gh" => "GHS",
    "gi" => "GIP",
    "gl" => "DKK",
    "gm" => "GMD",
    "gn" => "GNF",
    "gp" => "EUR",
    "gq" => "XAF",
    "gr" => "EUR",
    "gs" => "GBP",
    "gt" => "GTQ",
    "gu" => "USD",
    "gw" => "XOF",
    "gy" => "GYD",
    "hk" => "HKD",
    "hm" => "AUD",
    "hn" => "HNL",
    "hr" => "HRK",
    "ht" => "USD",
    "hu" => "HUF",
    "id" => "IDR",
    "ie" => "EUR",
    "il" => "ILS",
    "im" => "IMP",
    "in" => "INR",
    "io" => "USD",
    "iq" => "IQD",
    "ir" => "IRR",
    "is" => "ISK",
    "it" => "EUR",
    "je" => "JEP",
    "jm" => "JMD",
    "jo" => "JOD",
    "jp" => "JPY",
    "ke" => "KES",
    "kg" => "KGS",
    "kh" => "KHR",
    "ki" => "AUD",
    "km" => "KMF",
    "kn" => "XCD",
    "kp" => "KPW",
    "kr" => "KRW",
    "kw" => "KWD",
    "ky" => "KYD",
    "kz" => "KZT",
    "la" => "LAK",
    "lb" => "LBP",
    "lc" => "XCD",
    "li" => "CHF",
    "lk" => "LKR",
    "lr" => "LRD",
    "ls" => "LSL",
    "lt" => "EUR",
    "lu" => "EUR",
    "lv" => "EUR",
    "ly" => "LYD",
    "ma" => "MAD",
    "mc" => "EUR",
    "md" => "MDL",
    "me" => "EUR",
    "mf" => "EUR",
    "mg" => "MGA",
    "mh" => "USD",
    "mk" => "MKD",
    "ml" => "XOF",
    "mm" => "MMK",
    "mn" => "MNT",
    "mo" => "MOP",
    "mp" => "USD",
    "mq" => "EUR",
    "mr" => "MRO",
    "ms" => "XCD",
    "mt" => "EUR",
    "mu" => "MUR",
    "mv" => "MVR",
    "mw" => "MWK",
    "mx" => "MXN",
    "my" => "MYR",
    "mz" => "MZN",
    "na" => "NAD",
    "nc" => "XPF",
    "ne" => "XOF",
    "nf" => "AUD",
    "ng" => "NGN",
    "ni" => "NIO",
    "nl" => "EUR",
    "no" => "NOK",
    "np" => "NPR",
    "nr" => "AUD",
    "nu" => "NZD",
    "nz" => "NZD",
    "om" => "OMR",
    "pa" => "PAB",
    "pe" => "PEN",
    "pf" => "XPF",
    "pg" => "PGK",
    "ph" => "PHP",
    "pk" => "PKR",
    "pl" => "PLN",
    "pm" => "EUR",
    "pn" => "NZD",
    "pr" => "USD",
    "ps" => "ILS",
    "pt" => "EUR",
    "pw" => "USD",
    "py" => "PYG",
    "qa" => "QAR",
    "re" => "EUR",
    "ro" => "RON",
    "rs" => "RSD",
    "ru" => "RUB",
    "rw" => "RWF",
    "sa" => "SAR",
    "sb" => "SBD",
    "sc" => "SCR",
    "sd" => "SDG",
    "se" => "SEK",
    "sg" => "SGD",
    "sh" => "SHP",
    "si" => "EUR",
    "sj" => "NOK",
    "sk" => "EUR",
    "sl" => "SLL",
    "sm" => "EUR",
    "sn" => "XOF",
    "so" => "SOS",
    "sr" => "SRD",
    "ss" => "SSP",
    "st" => "STD",
    "sv" => "USD",
    "sx" => "ANG",
    "sy" => "SYP",
    "sz" => "SZL",
    "tc" => "USD",
    "td" => "XAF",
    "tf" => "EUR",
    "tg" => "XOF",
    "th" => "THB",
    "tj" => "TJS",
    "tk" => "NZD",
    "tl" => "IDR",
    "tm" => "TMT",
    "tn" => "TND",
    "to" => "TOP",
    "tr" => "TRY",
    "tt" => "TTD",
    "tv" => "TVD",
    "tw" => "TWD",
    "tz" => "TZS",
    "ua" => "UAH",
    "ug" => "UGX",
    "um" => "USD",
    "us" => "USD",
    "uy" => "UYU",
    "uz" => "UZS",
    "va" => "EUR",
    "vc" => "XCD",
    "ve" => "VEF",
    "vg" => "USD",
    "vi" => "USD",
    "vn" => "VND",
    "vu" => "VUV",
    "wf" => "XPF",
    "ws" => "USD",
    "ye" => "YER",
    "yt" => "EUR",
    "za" => "ZAR",
    "zm" => "ZMW",
    "zw" => "USD"
  }
  @default_currency "USD"

  @countries_time_zone %{
    "ad" => "Europe/Andorra",
    "ae" => "Asia/Dubai",
    "af" => "Asia/Kabul",
    "ag" => "America/Port_of_Spain",
    "ai" => "America/Port_of_Spain",
    "al" => "Europe/Tirane",
    "am" => "Asia/Yerevan",
    "ao" => "Africa/Lagos",
    "aq" => "Antarctica/Casey",
    "ar" => "America/Argentina/Buenos_Aires",
    "as" => "Pacific/Pago_Pago",
    "at" => "Europe/Vienna",
    "au" => "Australia/Lord_Howe",
    "aw" => "America/Curacao",
    "ax" => "Europe/Helsinki",
    "az" => "Asia/Baku",
    "ba" => "Europe/Belgrade",
    "bb" => "America/Barbados",
    "bd" => "Asia/Dhaka",
    "be" => "Europe/Brussels",
    "bf" => "Africa/Abidjan",
    "bg" => "Europe/Sofia",
    "bh" => "Asia/Qatar",
    "bi" => "Africa/Maputo",
    "bj" => "Africa/Lagos",
    "bl" => "America/Port_of_Spain",
    "bm" => "Atlantic/Bermuda",
    "bn" => "Asia/Brunei",
    "bo" => "America/La_Paz",
    "bq" => "America/Curacao",
    "br" => "America/Noronha",
    "bs" => "America/Nassau",
    "bt" => "Asia/Thimphu",
    "bv" => "Europe/Oslo",
    "bw" => "Africa/Maputo",
    "by" => "Europe/Minsk",
    "bz" => "America/Belize",
    "ca" => "America/St_Johns",
    "cc" => "Indian/Cocos",
    "cd" => "Africa/Maputo",
    "cf" => "Africa/Lagos",
    "cg" => "Africa/Lagos",
    "ch" => "Europe/Zurich",
    "ci" => "Africa/Abidjan",
    "ck" => "Pacific/Rarotonga",
    "cl" => "America/Santiago",
    "cm" => "Africa/Lagos",
    "cn" => "Asia/Shanghai",
    "co" => "America/Bogota",
    "cr" => "America/Costa_Rica",
    "cu" => "America/Havana",
    "cv" => "Atlantic/Cape_Verde",
    "cw" => "America/Curacao",
    "cx" => "Indian/Christmas",
    "cy" => "Asia/Nicosia",
    "cz" => "Europe/Prague",
    "de" => "Europe/Berlin",
    "dj" => "Africa/Nairobi",
    "dk" => "Europe/Copenhagen",
    "dm" => "America/Port_of_Spain",
    "do" => "America/Santo_Domingo",
    "dz" => "Africa/Algiers",
    "ec" => "America/Guayaquil",
    "ee" => "Europe/Tallinn",
    "eg" => "Africa/Cairo",
    "eh" => "Africa/El_Aaiun",
    "er" => "Africa/Nairobi",
    "es" => "Europe/Madrid",
    "et" => "Africa/Nairobi",
    "fi" => "Europe/Helsinki",
    "fj" => "Pacific/Fiji",
    "fk" => "Atlantic/Stanley",
    "fm" => "Pacific/Chuuk",
    "fo" => "Atlantic/Faroe",
    "fr" => "Europe/Paris",
    "ga" => "Africa/Lagos",
    "gb" => "Europe/London",
    "gd" => "America/Port_of_Spain",
    "ge" => "Asia/Tbilisi",
    "gf" => "America/Cayenne",
    "gg" => "Europe/London",
    "gh" => "Africa/Accra",
    "gi" => "Europe/Gibraltar",
    "gl" => "America/Godthab",
    "gm" => "Africa/Abidjan",
    "gn" => "Africa/Abidjan",
    "gp" => "America/Port_of_Spain",
    "gq" => "Africa/Lagos",
    "gr" => "Europe/Athens",
    "gs" => "Atlantic/South_Georgia",
    "gt" => "America/Guatemala",
    "gu" => "Pacific/Guam",
    "gw" => "Africa/Bissau",
    "gy" => "America/Guyana",
    "hk" => "Asia/Hong_Kong",
    "hm" => "Australia/Lord_Howe",
    "hn" => "America/Tegucigalpa",
    "hr" => "Europe/Belgrade",
    "ht" => "America/Port-au-Prince",
    "hu" => "Europe/Budapest",
    "id" => "Asia/Jakarta",
    "ie" => "Europe/Dublin",
    "il" => "Asia/Jerusalem",
    "im" => "Europe/London",
    "in" => "Asia/Kolkata",
    "io" => "Indian/Chagos",
    "iq" => "Asia/Baghdad",
    "ir" => "Asia/Tehran",
    "is" => "Atlantic/Reykjavik",
    "it" => "Europe/Rome",
    "je" => "Europe/London",
    "jm" => "America/Jamaica",
    "jo" => "Asia/Amman",
    "jp" => "Asia/Tokyo",
    "ke" => "Africa/Nairobi",
    "kg" => "Asia/Bishkek",
    "kh" => "Asia/Bangkok",
    "ki" => "Pacific/Tarawa",
    "km" => "Africa/Nairobi",
    "kn" => "America/Port_of_Spain",
    "kp" => "Asia/Pyongyang",
    "kr" => "Asia/Seoul",
    "kw" => "Asia/Riyadh",
    "ky" => "America/Panama",
    "kz" => "Asia/Almaty",
    "la" => "Asia/Bangkok",
    "lb" => "Asia/Beirut",
    "lc" => "America/Port_of_Spain",
    "li" => "Europe/Zurich",
    "lk" => "Asia/Colombo",
    "lr" => "Africa/Monrovia",
    "ls" => "Africa/Johannesburg",
    "lt" => "Europe/Vilnius",
    "lu" => "Europe/Luxembourg",
    "lv" => "Europe/Riga",
    "ly" => "Africa/Tripoli",
    "ma" => "Africa/Casablanca",
    "mc" => "Europe/Monaco",
    "md" => "Europe/Chisinau",
    "me" => "Europe/Belgrade",
    "mf" => "America/Port_of_Spain",
    "mg" => "Africa/Nairobi",
    "mh" => "Pacific/Majuro",
    "mk" => "Europe/Belgrade",
    "ml" => "Africa/Abidjan",
    "mm" => "Asia/Yangon",
    "mn" => "Asia/Ulaanbaatar",
    "mo" => "Asia/Macau",
    "mp" => "Pacific/Guam",
    "mq" => "America/Martinique",
    "mr" => "Africa/Abidjan",
    "ms" => "America/Port_of_Spain",
    "mt" => "Europe/Malta",
    "mu" => "Indian/Mauritius",
    "mv" => "Indian/Maldives",
    "mw" => "Africa/Maputo",
    "mx" => "America/Mexico_City",
    "my" => "Asia/Kuala_Lumpur",
    "mz" => "Africa/Maputo",
    "na" => "Africa/Windhoek",
    "nc" => "Pacific/Noumea",
    "ne" => "Africa/Lagos",
    "nf" => "Pacific/Norfolk",
    "ng" => "Africa/Lagos",
    "ni" => "America/Managua",
    "nl" => "Europe/Amsterdam",
    "no" => "Europe/Oslo",
    "np" => "Asia/Kathmandu",
    "nr" => "Pacific/Nauru",
    "nu" => "Pacific/Niue",
    "nz" => "Pacific/Auckland",
    "om" => "Asia/Dubai",
    "pa" => "America/Panama",
    "pe" => "America/Lima",
    "pf" => "Pacific/Tahiti",
    "pg" => "Pacific/Port_Moresby",
    "ph" => "Asia/Manila",
    "pk" => "Asia/Karachi",
    "pl" => "Europe/Warsaw",
    "pm" => "America/Miquelon",
    "pn" => "Pacific/Pitcairn",
    "pr" => "America/Puerto_Rico",
    "ps" => "Asia/Gaza",
    "pt" => "Europe/Lisbon",
    "pw" => "Pacific/Palau",
    "py" => "America/Asuncion",
    "qa" => "Asia/Qatar",
    "re" => "Indian/Reunion",
    "ro" => "Europe/Bucharest",
    "rs" => "Europe/Belgrade",
    "ru" => "Europe/Kaliningrad",
    "rw" => "Africa/Maputo",
    "sa" => "Asia/Riyadh",
    "sb" => "Pacific/Guadalcanal",
    "sc" => "Indian/Mahe",
    "sd" => "Africa/Khartoum",
    "se" => "Europe/Stockholm",
    "sg" => "Asia/Singapore",
    "sh" => "Africa/Abidjan",
    "si" => "Europe/Belgrade",
    "sj" => "Europe/Oslo",
    "sk" => "Europe/Prague",
    "sl" => "Africa/Abidjan",
    "sm" => "Europe/Rome",
    "sn" => "Africa/Abidjan",
    "so" => "Africa/Nairobi",
    "sr" => "America/Paramaribo",
    "ss" => "Africa/Juba",
    "st" => "Africa/Sao_Tome",
    "sv" => "America/El_Salvador",
    "sx" => "America/Curacao",
    "sy" => "Asia/Damascus",
    "sz" => "Africa/Johannesburg",
    "tc" => "America/Grand_Turk",
    "td" => "Africa/Ndjamena",
    "tf" => "Indian/Kerguelen",
    "tg" => "Africa/Abidjan",
    "th" => "Asia/Bangkok",
    "tj" => "Asia/Dushanbe",
    "tk" => "Pacific/Fakaofo",
    "tl" => "Asia/Dili",
    "tm" => "Asia/Ashgabat",
    "tn" => "Africa/Tunis",
    "to" => "Pacific/Tongatapu",
    "tr" => "Europe/Istanbul",
    "tt" => "America/Port_of_Spain",
    "tv" => "Pacific/Funafuti",
    "tw" => "Asia/Taipei",
    "tz" => "Africa/Nairobi",
    "ua" => "Europe/Kiev",
    "ug" => "Africa/Nairobi",
    "um" => "Pacific/Wake",
    "us" => "America/New_York",
    "uy" => "America/Montevideo",
    "uz" => "Asia/Samarkand",
    "va" => "Europe/Rome",
    "vc" => "America/Port_of_Spain",
    "ve" => "America/Caracas",
    "vg" => "America/Port_of_Spain",
    "vi" => "America/Port_of_Spain",
    "vn" => "Asia/Ho_Chi_Minh",
    "vu" => "Pacific/Efate",
    "wf" => "Pacific/Wallis",
    "ws" => "Pacific/Apia",
    "ye" => "Asia/Riyadh",
    "yt" => "Africa/Nairobi",
    "za" => "Africa/Johannesburg",
    "zm" => "Africa/Maputo",
    "zw" => "Africa/Maputo"
  }
  @default_time_zone "America/Argentina/Buenos_Aires"

  def currency(country) when is_binary(country) do
    @currencies_by_country[country] || @default_currency
  end

  def valid_countries do
    @currencies_by_country |> Map.keys()
  end

  def time_zone_or_country_default(tz, country) when tz in ["", nil] do
    @countries_time_zone[country] || @default_time_zone
  end

  def time_zone_or_country_default(tz, _country), do: tz

  def guess_country_from_ip(ip) do
    case Geolix.lookup(ip) do
      %{default: %{country: %{iso_code: country}}} -> String.downcase(country)
      _ -> nil
    end
  end

  def phone_prefix_for_country(nil), do: nil

  def phone_prefix_for_country(country) do
    case ExPhoneNumber.Metadata.get_country_code_for_region_code(country) do
      0 -> nil
      prefix -> "+#{prefix}"
    end
  end

  def phone_prefix_for_ip(ip) do
    ip |> guess_country_from_ip() |> phone_prefix_for_country()
  end

  def valid_phone?(number, country \\ nil) do
    ExPhoneNumber.is_possible_number?(number, country)
  end
end
